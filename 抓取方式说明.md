# YouTube è§†é¢‘ URL æŠ“å–æ–¹å¼è¯¦ç»†è¯´æ˜

## ğŸ“‹ æŠ“å–æŠ€æœ¯æ ˆ

- **æ ¸å¿ƒåº“**: `yt-dlp` (YouTube-DL çš„å¢å¼ºç‰ˆ)
- **Python ç‰ˆæœ¬**: 3.8+
- **æŠ“å–æ¨¡å¼**: æ’­æ”¾åˆ—è¡¨å…ƒæ•°æ®æå–ï¼ˆä¸ä¸‹è½½è§†é¢‘ï¼‰

---

## ğŸ”§ æ ¸å¿ƒæŠ“å–é…ç½®

### ä¸»è¦é…ç½®å‚æ•°ï¼ˆç¬¬ 71-84 è¡Œï¼‰

```python
ydl_opts_flat = {
    'extract_flat': 'in_playlist',  # å…³é”®å‚æ•°ï¼šåªåœ¨æ’­æ”¾åˆ—è¡¨ä¸­æå–å…ƒæ•°æ®
    'quiet': False,                  # æ˜¾ç¤ºè¿›åº¦ä¿¡æ¯
    'no_warnings': False,            # æ˜¾ç¤ºè­¦å‘Šä¿¡æ¯
    'ignoreerrors': True,            # å¿½ç•¥é”™è¯¯ï¼Œç»§ç»­æŠ“å–
    'playlistend': 300,              # é™åˆ¶æŠ“å–æ•°é‡ï¼ˆæœ€å¤š300æ¡ï¼‰
    'playlistreverse': False,        # ä¸åè½¬åˆ—è¡¨ï¼ˆä¿æŒä»æ–°åˆ°æ—§ï¼‰
    'extractor_args': {
        'youtube': {
            'player_client': ['android', 'web'],  # ä½¿ç”¨ç§»åŠ¨ç«¯å’Œç½‘é¡µç«¯å®¢æˆ·ç«¯
            'player_skip': ['webpage', 'configs'], # è·³è¿‡ç½‘é¡µå’Œé…ç½®è§£æ
        }
    }
}
```

### å…³é”®å‚æ•°è¯¦è§£

#### 1. `extract_flat: 'in_playlist'` â­ æœ€é‡è¦
- **ä½œç”¨**: åªåœ¨æ’­æ”¾åˆ—è¡¨ä¸­æå–å…ƒæ•°æ®ï¼Œä¸å¤„ç†å•ä¸ªè§†é¢‘
- **ä¼˜åŠ¿**: 
  - é€Ÿåº¦æå¿«ï¼ˆ8ç§’æŠ“å–300æ¡ï¼‰
  - é¿å…è§¦å‘ YouTube åçˆ¬è™«éªŒè¯
  - ä¸ä¸‹è½½è§†é¢‘ï¼Œåªè·å–é“¾æ¥
- **åŸç†**: YouTube é¢‘é“çš„ `/videos` é¡µé¢æœ¬èº«å°±æ˜¯ä¸€ä¸ªæ’­æ”¾åˆ—è¡¨ï¼Œä½¿ç”¨æ­¤æ¨¡å¼å¯ä»¥ç›´æ¥è·å–åˆ—è¡¨ç»“æ„

#### 2. `playlistend: 300`
- **ä½œç”¨**: é™åˆ¶æŠ“å–æ•°é‡ä¸º 300 æ¡
- **è¯´æ˜**: YouTube ä¼šè¿”å›æ‰€æœ‰è§†é¢‘ï¼Œä½† yt-dlp åªå¤„ç†å‰ 300 æ¡

#### 3. `playlistreverse: False`
- **ä½œç”¨**: ä¿æŒåŸå§‹æ’åºï¼ˆä¸åè½¬ï¼‰
- **è¯´æ˜**: YouTube é¢‘é“çš„ `/videos` é¡µé¢é»˜è®¤å°±æ˜¯æŒ‰æ—¶é—´ä»æ–°åˆ°æ—§æ’åºï¼Œæ‰€ä»¥ä¸éœ€è¦åè½¬

#### 4. `player_client: ['android', 'web']`
- **ä½œç”¨**: æŒ‡å®šä½¿ç”¨ç§»åŠ¨ç«¯å’Œç½‘é¡µç«¯å®¢æˆ·ç«¯
- **ä¼˜åŠ¿**: å‡å°‘è¢«è¯†åˆ«ä¸ºæœºå™¨äººçš„æ¦‚ç‡

#### 5. `player_skip: ['webpage', 'configs']`
- **ä½œç”¨**: è·³è¿‡ç½‘é¡µå’Œé…ç½®è§£æ
- **ä¼˜åŠ¿**: è¿›ä¸€æ­¥åŠ å¿«é€Ÿåº¦ï¼Œå‡å°‘è¯·æ±‚

---

## ğŸ”„ å®Œæ•´æŠ“å–æµç¨‹

### ç¬¬ä¸€æ­¥ï¼šURL æ ‡å‡†åŒ–ï¼ˆç¬¬ 30-51 è¡Œï¼‰

```python
def _get_channel_upload_url(self, channel_url: str) -> str:
    # å°†å„ç§æ ¼å¼çš„é¢‘é“ URL è½¬æ¢ä¸ºæ ‡å‡†çš„ä¸Šä¼ åˆ—è¡¨ URL
    # æ”¯æŒæ ¼å¼ï¼š
    # - https://www.youtube.com/@é¢‘é“å/videos âœ…
    # - https://www.youtube.com/channel/é¢‘é“ID/videos âœ…
    # - https://www.youtube.com/c/é¢‘é“å/videos âœ…
    # - https://www.youtube.com/@é¢‘é“å â†’ è‡ªåŠ¨æ·»åŠ  /videos âœ…
```

**ç¤ºä¾‹è½¬æ¢**:
- è¾“å…¥: `https://www.youtube.com/@AhrefsCom`
- è¾“å‡º: `https://www.youtube.com/@AhrefsCom/videos`

### ç¬¬äºŒæ­¥ï¼šè·å–æ’­æ”¾åˆ—è¡¨ä¿¡æ¯ï¼ˆç¬¬ 87-89 è¡Œï¼‰

```python
with yt_dlp.YoutubeDL(ydl_opts_flat) as ydl:
    info = ydl.extract_info(upload_url, download=False, process=False)
```

**å…³é”®ç‚¹**:
- `download=False`: ä¸ä¸‹è½½ä»»ä½•æ–‡ä»¶
- `process=False`: é…åˆ `extract_flat`ï¼Œåªè·å–åˆ—è¡¨ç»“æ„ï¼Œä¸å¤„ç†å•ä¸ªè§†é¢‘

**å®é™…æ‰§è¡Œè¿‡ç¨‹**:
1. yt-dlp è®¿é—® `https://www.youtube.com/@AhrefsCom/videos`
2. è¯†åˆ«è¿™æ˜¯ä¸€ä¸ªæ’­æ”¾åˆ—è¡¨ï¼ˆYouTube Tabï¼‰
3. åˆ†é¡µè·å–æ‰€æœ‰è§†é¢‘æ¡ç›®ï¼ˆå…± 324 æ¡ï¼‰
4. è¿”å›æ’­æ”¾åˆ—è¡¨çš„å…ƒæ•°æ®ç»“æ„

### ç¬¬ä¸‰æ­¥ï¼šæå–è§†é¢‘æ¡ç›®ï¼ˆç¬¬ 95-103 è¡Œï¼‰

```python
entries = info.get('entries', [])  # è·å–è§†é¢‘æ¡ç›®åˆ—è¡¨

# å¦‚æœ entries æ˜¯ç”Ÿæˆå™¨ï¼Œè½¬æ¢ä¸ºåˆ—è¡¨
if hasattr(entries, '__iter__') and not isinstance(entries, (list, tuple)):
    entries = list(entries)  # å¼ºåˆ¶è½¬æ¢ä¸ºåˆ—è¡¨
```

**æ•°æ®ç»“æ„ç¤ºä¾‹**:
```python
entries = [
    {
        'id': '6NFei1FbytM',           # è§†é¢‘ ID
        'url': 'https://www.youtube.com/watch?v=6NFei1FbytM',  # å®Œæ•´ URL
        'title': 'è§†é¢‘æ ‡é¢˜',
        # ... å…¶ä»–å…ƒæ•°æ®
    },
    {
        'id': 'gReszNnykpg',
        'url': 'https://www.youtube.com/watch?v=gReszNnykpg',
        # ...
    },
    # ... å…± 324 æ¡
]
```

### ç¬¬å››æ­¥ï¼šæå–è§†é¢‘ URLï¼ˆç¬¬ 151-180 è¡Œï¼‰

```python
for idx, entry in enumerate(entries, 1):
    if idx > self.max_videos:  # é™åˆ¶ä¸º 300 æ¡
        break
    
    # ä¼˜å…ˆä½¿ç”¨ id å­—æ®µæ„å»ºå®Œæ•´ URL
    video_id = entry.get('id')
    if video_id:
        video_url = f"https://www.youtube.com/watch?v={video_id}"
        video_urls.append(video_url)
    # å¤‡ç”¨æ–¹æ¡ˆï¼šä» urlã€webpage_urlã€video_id å­—æ®µè·å–
```

**URL æå–ä¼˜å…ˆçº§**:
1. `entry['id']` â†’ æ„å»º `https://www.youtube.com/watch?v={id}`
2. `entry['url']` â†’ ç›´æ¥ä½¿ç”¨
3. `entry['webpage_url']` â†’ ç›´æ¥ä½¿ç”¨
4. `entry['video_id']` â†’ æ„å»ºå®Œæ•´ URL

### ç¬¬äº”æ­¥ï¼šä¿å­˜ç»“æœï¼ˆç¬¬ 202-226 è¡Œï¼‰

```python
def save_urls(self, video_urls: List[str], filename: Optional[str] = None):
    # ç”Ÿæˆæ–‡ä»¶åï¼šurls_snapshot_20260104_110042.txt
    # æ¯è¡Œä¸€ä¸ª URL
    with open(filepath, 'w', encoding='utf-8') as f:
        for url in video_urls:
            f.write(url + '\n')
```

---

## ğŸ“Š æ’åºæœºåˆ¶è¯´æ˜

### ä¸ºä»€ä¹ˆæ’åºæ˜¯æ­£ç¡®çš„ï¼ˆNewest Firstï¼‰ï¼Ÿ

1. **YouTube é»˜è®¤æ’åº**: 
   - é¢‘é“çš„ `/videos` é¡µé¢é»˜è®¤æŒ‰æ—¶é—´ä»æ–°åˆ°æ—§æ’åº
   - è¿™æ˜¯ YouTube çš„é»˜è®¤è¡Œä¸ºï¼Œä¸éœ€è¦é¢å¤–é…ç½®

2. **yt-dlp ä¿æŒåŸåº**:
   - `playlistreverse: False` ç¡®ä¿ä¸åè½¬åˆ—è¡¨
   - ç›´æ¥ä½¿ç”¨ YouTube è¿”å›çš„é¡ºåº

3. **éªŒè¯æ–¹æ³•**:
   ```python
   # ä»æ—¥å¿—å¯ä»¥çœ‹åˆ°ï¼š
   # [youtube:tab] UCWquNQV8Y0_defMKnGKrFOQ page 1: Downloading API JSON
   # [youtube:tab] UCWquNQV8Y0_defMKnGKrFOQ page 2: Downloading API JSON
   # ...
   # è¿™è¯´æ˜æ˜¯æŒ‰é¡µé¡ºåºè·å–çš„ï¼Œç¬¬ä¸€é¡µå°±æ˜¯æœ€æ–°çš„è§†é¢‘
   ```

---

## ğŸ›¡ï¸ åçˆ¬è™«ç»•è¿‡ç­–ç•¥

### ä¸ºä»€ä¹ˆä¸ä¼šè§¦å‘éªŒè¯ï¼Ÿ

1. **ä½¿ç”¨æ’­æ”¾åˆ—è¡¨ API**:
   - ä¸è®¿é—®å•ä¸ªè§†é¢‘é¡µé¢
   - åªè®¿é—®æ’­æ”¾åˆ—è¡¨ APIï¼ˆæ›´ç¨³å®šï¼‰

2. **extract_flat æ¨¡å¼**:
   - ä¸è§£æè§†é¢‘è¯¦æƒ…
   - ä¸ä¸‹è½½ä»»ä½•å†…å®¹
   - åªè·å–åˆ—è¡¨ç»“æ„

3. **å®¢æˆ·ç«¯ä¼ªè£…**:
   - `player_client: ['android', 'web']` æ¨¡æ‹Ÿç§»åŠ¨ç«¯å’Œç½‘é¡µç«¯

4. **å‡å°‘è¯·æ±‚**:
   - `player_skip: ['webpage', 'configs']` è·³è¿‡ä¸å¿…è¦çš„è§£æ

---

## âš¡ æ€§èƒ½ä¼˜åŒ–

### ä¸ºä»€ä¹ˆè¿™ä¹ˆå¿«ï¼ˆ8ç§’æŠ“å–300æ¡ï¼‰ï¼Ÿ

1. **ä¸ä¸‹è½½è§†é¢‘**: `download=False`
2. **ä¸å¤„ç†å•ä¸ªè§†é¢‘**: `extract_flat='in_playlist'` + `process=False`
3. **æ‰¹é‡è·å–**: ä¸€æ¬¡æ€§è·å–æ•´ä¸ªæ’­æ”¾åˆ—è¡¨
4. **è·³è¿‡è§£æ**: `player_skip` å‡å°‘å¤„ç†æ—¶é—´

### å¯¹æ¯”å…¶ä»–æ–¹å¼ï¼š

| æ–¹å¼ | æ—¶é—´ | è¯´æ˜ |
|------|------|------|
| **å½“å‰æ–¹å¼** | **8ç§’** | extract_flat + process=False |
| å®Œæ•´æ¨¡å¼ | 5-10åˆ†é’Ÿ | extract_flat=False + process=True |
| ä¸‹è½½æ¨¡å¼ | æ•°å°æ—¶ | å®é™…ä¸‹è½½è§†é¢‘ |

---

## ğŸ”„ å¤‡ç”¨æ–¹æ¡ˆï¼ˆç¬¬ 105-145 è¡Œï¼‰

å¦‚æœç¬¬ä¸€æ¬¡æŠ“å–æ•°é‡ä¸è¶³ï¼ˆå°‘äº 200 æ¡ï¼‰ï¼Œä¼šè‡ªåŠ¨å°è¯•å¤‡ç”¨æ–¹æ³•ï¼š

```python
ydl_opts_full = {
    'extract_flat': False,      # ä¸ä½¿ç”¨ extract_flat
    'process': True,             # å¤„ç†å•ä¸ªè§†é¢‘
    'skip_download': True,       # ä»ç„¶ä¸ä¸‹è½½
    # ... å…¶ä»–é…ç½®
}
```

**ä½¿ç”¨åœºæ™¯**: 
- æŸäº›é¢‘é“å¯èƒ½éœ€è¦å®Œæ•´å¤„ç†æ‰èƒ½è·å–å®Œæ•´åˆ—è¡¨
- ä½œä¸ºå¤‡ç”¨æ–¹æ¡ˆï¼Œç¡®ä¿èƒ½è·å–åˆ°è¶³å¤Ÿæ•°é‡

---

## ğŸ“ å®é™…æ‰§è¡Œæ—¥å¿—åˆ†æ

```
[youtube:tab] @AhrefsCom/videos: Downloading webpage
[youtube:tab] UCWquNQV8Y0_defMKnGKrFOQ page 1: Downloading API JSON
[youtube:tab] UCWquNQV8Y0_defMKnGKrFOQ page 2: Downloading API JSON
...
[youtube:tab] UCWquNQV8Y0_defMKnGKrFOQ page 10: Downloading API JSON
è·å–åˆ° 324 ä¸ªè§†é¢‘æ¡ç›®
å·²å¤„ç† 50/300 æ¡è§†é¢‘é“¾æ¥...
å·²å¤„ç† 100/300 æ¡è§†é¢‘é“¾æ¥...
...
æˆåŠŸæŠ“å– 300 æ¡è§†é¢‘é“¾æ¥
```

**æ—¥å¿—è§£è¯»**:
1. è®¿é—®é¢‘é“é¡µé¢
2. åˆ†é¡µè·å– API JSONï¼ˆå…± 10 é¡µï¼‰
3. è·å–åˆ° 324 ä¸ªè§†é¢‘æ¡ç›®
4. æå–å‰ 300 æ¡çš„ URL
5. å®ŒæˆæŠ“å–

---

## ğŸ¯ å…³é”®ä»£ç ä½ç½®

| åŠŸèƒ½ | ä»£ç ä½ç½® | è¯´æ˜ |
|------|---------|------|
| URL æ ‡å‡†åŒ– | `scraper.py:30-51` | ç»Ÿä¸€é¢‘é“ URL æ ¼å¼ |
| æŠ“å–é…ç½® | `scraper.py:71-84` | æ ¸å¿ƒé…ç½®å‚æ•° |
| è·å–åˆ—è¡¨ | `scraper.py:87-89` | yt-dlp æå–ä¿¡æ¯ |
| æå– URL | `scraper.py:151-180` | ä»æ¡ç›®ä¸­æå–é“¾æ¥ |
| ä¿å­˜æ–‡ä»¶ | `scraper.py:202-226` | å†™å…¥ç»“æœæ–‡ä»¶ |

---

## ğŸ’¡ æŠ€æœ¯è¦ç‚¹æ€»ç»“

1. **ä½¿ç”¨ `extract_flat='in_playlist'`**: åªæå–æ’­æ”¾åˆ—è¡¨å…ƒæ•°æ®ï¼Œä¸å¤„ç†å•ä¸ªè§†é¢‘
2. **ä½¿ç”¨ `process=False`**: é…åˆ extract_flatï¼Œåªè·å–åˆ—è¡¨ç»“æ„
3. **åˆ©ç”¨ YouTube é»˜è®¤æ’åº**: é¢‘é“çš„ `/videos` é¡µé¢é»˜è®¤ä»æ–°åˆ°æ—§
4. **æ‰¹é‡è·å–**: ä¸€æ¬¡æ€§è·å–æ•´ä¸ªæ’­æ”¾åˆ—è¡¨ï¼Œè€Œä¸æ˜¯é€ä¸ªè§†é¢‘
5. **é¿å…åçˆ¬è™«**: ä½¿ç”¨æ’­æ”¾åˆ—è¡¨ APIï¼Œä¸è®¿é—®å•ä¸ªè§†é¢‘é¡µé¢

---

## ğŸ“š å‚è€ƒèµ„æ–™

- [yt-dlp å®˜æ–¹æ–‡æ¡£](https://github.com/yt-dlp/yt-dlp)
- [extract_flat å‚æ•°è¯´æ˜](https://github.com/yt-dlp/yt-dlp#extract-flat)
- [YouTube æ’­æ”¾åˆ—è¡¨æå–](https://github.com/yt-dlp/yt-dlp/wiki/Playlists)

